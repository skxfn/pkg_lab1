# Документация к приложению «Цветовые модели RGB ↔ XYZ ↔ CMYK»

Версия: 1.0

## 1. Назначение
Веб‑приложение позволяет интерактивно выбирать и изменять цвет, одновременно отображая его представления в трёх моделях: RGB, XYZ и CMYK. При изменении любой координаты остальные модели пересчитываются автоматически. Реализованы предупреждения о выходе за гамму при преобразовании XYZ→RGB.

## 2. Цветовые модели и формулы

### 2.1. RGB (sRGB)
- Диапазоны: R,G,B ∈ [0,255] (внутренне нормируем к [0,1]).
- Компандирование IEC 61966-2-1:
  - Вперёд (lin→srgb):
    - если c ≤ 0.0031308: c_s = 12.92 · c
    - иначе: c_s = 1.055 · c^(1/2.4) − 0.055
  - Обратно (srgb→lin):
    - если c ≤ 0.04045: c = c_s / 12.92
    - иначе: c = ((c_s + 0.055)/1.055)^2.4

### 2.2. XYZ (D65, Yn=100)
- Используются матрицы для sRGB, белая точка D65 (2°), масштабирование к Yn=100.
- Матрица RGB→XYZ (над линейным RGB):
  X = 0.4124564 R + 0.3575761 G + 0.1804375 B
  Y = 0.2126729 R + 0.7151522 G + 0.0721750 B
  Z = 0.0193339 R + 0.1191920 G + 0.9503041 B
- Обратная матрица XYZ→RGB (получаем линейный RGB, затем компандируем в sRGB):
  R = 3.2404542 X − 1.5371385 Y − 0.4985314 Z
  G = −0.9692660 X + 1.8760108 Y + 0.0415560 Z
  B = 0.0556434 X − 0.2040259 Y + 1.0572252 Z
  (в формулах X,Y,Z берутся в долях от 100, т.е. X/100, Y/100, Z/100)

- При XYZ→RGB возможен выход за диапазон [0,1] у линейного R,G,B — выполняем обрезание (clipping) с мягким предупреждением.

### 2.3. CMYK (аппроксимация, device‑independent)
- K = 1 − max(R,G,B) (R,G,B в [0,1]).
- Если K≈1, то C=M=Y=0; иначе:
  C = (1 − R − K)/(1 − K), M = (1 − G − K)/(1 − K), Y = (1 − B − K)/(1 − K).
- В интерфейсе C,M,Y,K показываются в процентах [0..100].

## 3. Функциональные возможности
- Ввод точных значений: числовые поля для RGB/XYZ/CMYK.
- Плавная настройка: ползунки для всех координат.
- Палитра: встроенный color picker синхронизирован с RGB/HEX.
- Автопересчёт: изменения любой координаты мгновенно обновляют остальные модели.
- Предупреждения о клиппинге при XYZ→RGB.
- Отображение HEX и предпросмотр цвета.

## 4. Архитектура
- `color_models.py` — математические преобразования и утилиты (HEX, клиппинг).
- `app.py` — UI на Streamlit; синхронизация через `st.session_state` и `on_change` колбэки.
- `run_app.py` — лаунчер для упаковки в один файл.
- Скрипты сборки: `build_windows.bat`, `build_macos.sh`.

## 5. Запуск и сборка

### 5.1. Локальный запуск
```bash
pip install -r requirements.txt
streamlit run app.py
```
Откройте в браузере адрес из лога (обычно `http://localhost:8501`).

### 5.2. Сборка под Windows (EXE)
В Windows:
```bat
build_windows.bat
```
Или вручную:
```bat
pip install -r requirements.txt
pip install pyinstaller
pyinstaller --onefile --windowed --name ColorModelsApp run_app.py
```
Готовый файл: `dist/ColorModelsApp.exe`.

### 5.3. Сборка под macOS (локальный бинарник)
```bash
./build_macos.sh
```
Или вручную:
```bash
pip install -r requirements.txt
pip install pyinstaller
pyinstaller --onefile --windowed --name ColorModelsApp run_app.py
```
Запуск: двойной клик по `dist/ColorModelsApp.app` или из терминала:
`open dist/ColorModelsApp.app`

## 6. Деплой (веб)
- Streamlit Community Cloud: подключить репозиторий, указать `app.py`, Python 3.11 (`runtime.txt`).
- Hugging Face Spaces (Streamlit): шаблон Streamlit, `requirements.txt`.

## 7. Проверка корректности
- Изменение любой координаты (RGB/XYZ/CMYK) приводит к моментальному пересчёту других.
- При выходе XYZ→RGB за гамму отображается предупреждение.
- Санити‑чек: RGB→XYZ→RGB и RGB→CMYK→RGB дают согласованные результаты (с учётом округлений/клиппинга).

## 8. Ограничения и примечания
- CMYK реализован как девайс‑независимая модель (без ICC‑профилей принтера), поэтому служит для наглядной иллюстрации, а не для полиграфической подготовки.
- XYZ масштабирован на Yn=100 (D65). При вводе значений вне практических диапазонов возможны клиппинги.

## 9. Авторы и исходный код
- Исходники: см. репозиторий (структура в корне проекта).
- Лицензирование и контакты — по договорённости.
